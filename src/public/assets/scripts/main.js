biigle.$viewModel("export-container",function(e){var t=biigle.$require("messages.store"),n={volumes:biigle.$require("api.volumes"),labelTrees:biigle.$require("api.labelTree"),users:biigle.$require("api.users")},i=biigle.$require("sync.exportApiUrl");new Vue({el:e,mixins:[biigle.$require("core.mixins.loader")],components:{tabs:VueStrap.tabs,tab:VueStrap.tab,entityChooser:biigle.$require("sync.components.entityChooser")},data:{indexMap:["volumes","labelTrees","users"],entities:{volumes:[],labelTrees:[],users:[]},chosenEntities:{volumes:[],labelTrees:[],users:[]},currentTab:0},computed:{volumes:function(){return this.entities.volumes},labelTrees:function(){return this.entities.labelTrees},users:function(){return this.entities.users.map(function(e){return e.name=e.firstname+" "+e.lastname,e.email&&(e.description=e.email),e})},hasNoChosenVolumes:function(){return 0===this.chosenEntities.volumes.length},hasNoChosenLabelTrees:function(){return 0===this.chosenEntities.labelTrees.length},hasNoChosenUsers:function(){return 0===this.chosenEntities.users.length},volumeRequestUrl:function(){return i+"/volumes"+this.getQueryString("volumes")},labelTreeRequestUrl:function(){return i+"/label-trees"+this.getQueryString("labelTrees")},userRequestUrl:function(){return i+"/users"+this.getQueryString("users")}},methods:{handleSwitchedTab:function(e){this.currentTab=e},fetchEntities:function(e){0===this.entities[e].length&&(this.startLoading(),n[e].get().bind(this).then(function(t){this.entities[e]=t.data},t.handleErrorResponse).finally(this.finishLoading))},handleChosenVolumes:function(e){this.chosenEntities.volumes=e},handleChosenLabelTrees:function(e){this.chosenEntities.labelTrees=e},handleChosenUsers:function(e){this.chosenEntities.users=e},getQueryString:function(e){var t=this.entities[e],n=this.chosenEntities[e];return t.length/2>n.length?"?only="+(n.map(function(e){return e.id}).join(",")||-1):t.length>n.length?"?except="+t.filter(function(e){return-1===n.indexOf(e)}).map(function(e){return e.id}).join(","):""}},watch:{currentTab:function(e){this.fetchEntities(this.indexMap[e])}},created:function(){this.fetchEntities(this.indexMap[0])}})}),biigle.$component("sync.components.entityChooser",{template:"#entity-chooser-template",components:{entityChooserList:biigle.$require("sync.components.entityChooserList")},props:{entities:{type:Array,required:!0}},data:function(){return{chosenIds:{},filterQuery:""}},computed:{unchosenEntities:function(){return this.entities.filter(function(e){return!this.chosenIds[e.id]},this)},unchosenFilteredEntities:function(){var e=this.filterQuery.trim();if(e){var t=e.toLowerCase().split(" ");return this.unchosenEntities.filter(function(e){var n=e.name.toLowerCase();return e.description&&(n+=" "+e.description.toLowerCase()),t.reduce(function(e,t){return e&&-1!==n.indexOf(t)},!0)})}return this.unchosenEntities},chosenEntities:function(){return this.entities.filter(function(e){return this.chosenIds[e.id]},this)},hasNoUnchosenEntities:function(){return 0===this.unchosenEntities.length},hasNoChosenEntities:function(){return 0===this.chosenEntities.length}},methods:{handleSelect:function(e){Vue.set(this.chosenIds,e.id,!0)},handleDeselect:function(e){this.chosenIds[e.id]=!1},chooseAll:function(){this.unchosenFilteredEntities.forEach(this.handleSelect)},chooseNone:function(){this.chosenEntities.forEach(this.handleDeselect)},handleFiltering:function(e){this.filterQuery=e}},watch:{chosenEntities:function(e){this.$emit("select",e)}}}),biigle.$component("sync.components.entityChooserList",{template:"#entity-chooser-list-template",props:{entities:{type:Array,required:!0},filtering:{type:Boolean,default:!1}},data:function(){return{filterQuery:""}},computed:{},methods:{select:function(e){this.$emit("select",e)}},watch:{filterQuery:function(e){this.$emit("filter",e)}}});