biigle.$viewModel("project-report-form",function(e){var t=biigle.$require("reports.projectId");new Vue({el:e,mixins:[biigle.$require("reports.mixins.reportForm")],data:{allowedOptions:{Annotations:["export_area","newest_label","separate_label_trees","only_labels","aggregate_child_labels"],ImageLabels:["separate_label_trees","only_labels"],VideoAnnotations:["separate_label_trees","only_labels"]}},methods:{submit:function(){this.request(t,biigle.$require("reports.api.projectReports"))}}})}),biigle.$viewModel("video-report-form",function(e){var t=biigle.$require("reports.videoId");new Vue({el:e,mixins:[biigle.$require("reports.mixins.reportForm")],data:{selectedType:"VideoAnnotations",selectedVariant:"Csv",allowedOptions:{VideoAnnotations:["separate_label_trees","only_labels"]}},methods:{submit:function(){this.request(t,biigle.$require("reports.api.videoReports"))}}})}),biigle.$viewModel("volume-report-form",function(e){var t=biigle.$require("reports.volumeId");new Vue({el:e,mixins:[biigle.$require("reports.mixins.reportForm")],data:{allowedOptions:{Annotations:["export_area","newest_label","separate_label_trees","annotation_session_id","only_labels","aggregate_child_labels"],ImageLabels:["separate_label_trees","annotation_session_id","only_labels"]},options:{annotation_session_id:null}},methods:{submit:function(){this.request(t,biigle.$require("reports.api.volumeReports"))}}})}),biigle.$declare("reports.api.projectReports",Vue.resource("/api/v1/projects{/id}/reports")),biigle.$declare("reports.api.videoReports",Vue.resource("/api/v1/videos{/id}/reports")),biigle.$declare("reports.api.volumeReports",Vue.resource("/api/v1/volumes{/id}/reports")),biigle.$component("reports.mixins.reportForm",{mixins:[biigle.$require("core.mixins.loader")],components:{labelTrees:biigle.$require("labelTrees.components.labelTrees")},data:{allowedOptions:{},selectedType:"",selectedVariant:"",reportTypes:[],labelTrees:[],hasOnlyLabels:!1,success:!1,errors:{},options:{export_area:!1,newest_label:!1,separate_label_trees:!1,only_labels:[],aggregate_child_labels:!1}},computed:{flatLabels:function(){var e=[];return this.labelTrees.forEach(function(t){Array.prototype.push.apply(e,t.labels)}),e},selectedLabels:function(){return this.flatLabels.filter(function(e){return e.selected})},selectedLabelsCount:function(){return this.selectedLabels.length},variants:function(){var e={};return this.reportTypes.forEach(function(t){var r=t.name.split("\\");e.hasOwnProperty(r[0])||(e[r[0]]=[]),e[r[0]].push(r[1])}),e},availableReportTypes:function(){var e={};return this.reportTypes.forEach(function(t){e[t.name]=t.id}),e},selectedReportTypeId:function(){return this.availableReportTypes[this.selectedType+"\\"+this.selectedVariant]},availableVariants:function(){return this.variants[this.selectedType]},onlyOneAvailableVariant:function(){return 1===this.availableVariants.length},selectedOptions:function(){var e={};return this.allowedOptions[this.selectedType].forEach(function(t){e[t]=this.options[t]},this),e.type_id=this.selectedReportTypeId,e}},methods:{request:function(e,t){this.loading||(this.success=!1,this.startLoading(),t.save({id:e},this.selectedOptions).then(this.submitted,this.handleError).finally(this.finishLoading))},submitted:function(){this.success=!0,this.errors={}},handleError:function(e){422===e.status?this.errors=e.data:biigle.$require("messages.store").handleErrorResponse(e)},selectType:function(e){this.selectedType=e,-1===this.availableVariants.indexOf(this.selectedVariant)&&(this.selectedVariant=this.availableVariants[0])},wantsType:function(e){return this.selectedType===e},wantsVariant:function(e){return Array.isArray(e)?-1!==e.indexOf(this.selectedVariant):this.selectedVariant===e},hasError:function(e){return this.errors.hasOwnProperty(e)},getError:function(e){return this.errors[e]?this.errors[e].join(" "):""},wantsCombination:function(e,t){return this.wantsType(e)&&this.wantsVariant(t)}},watch:{selectedLabels:function(e){this.options.only_labels=e.map(function(e){return e.id})},hasOnlyLabels:function(e){e||this.flatLabels.forEach(function(e){e.selected=!1})}},created:function(){this.reportTypes=biigle.$require("reports.reportTypes"),this.selectedType=Object.keys(this.variants)[0],this.selectedVariant=this.availableVariants[0],this.labelTrees=biigle.$require("reports.labelTrees")}});