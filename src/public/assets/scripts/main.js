biigle.$viewModel("export-container",function(e){var t=biigle.$require("messages.store"),i={volumes:biigle.$require("api.volumes"),labelTrees:biigle.$require("api.labelTree"),users:biigle.$require("api.users")},n=biigle.$require("sync.exportApiUrl"),s=biigle.$require("sync.allowedExports");new Vue({el:e,mixins:[biigle.$require("core.mixins.loader")],components:{tabs:VueStrap.tabs,tab:VueStrap.tab,entityChooser:biigle.$require("sync.components.entityChooser")},data:{entities:{volumes:[],labelTrees:[],users:[]},chosenEntities:{volumes:[],labelTrees:[],users:[]},currentTab:0},computed:{indexMap:function(){return["volumes","labelTrees","users"].filter(function(e){return-1!==s.indexOf(e)})},volumes:function(){return this.entities.volumes},labelTrees:function(){return this.entities.labelTrees},users:function(){return this.entities.users.map(function(e){return e.name=e.firstname+" "+e.lastname,e.email&&(e.description=e.email),e})},hasNoChosenVolumes:function(){return 0===this.chosenEntities.volumes.length},hasNoChosenLabelTrees:function(){return 0===this.chosenEntities.labelTrees.length},hasNoChosenUsers:function(){return 0===this.chosenEntities.users.length},volumeRequestUrl:function(){return n+"/volumes"+this.getQueryString("volumes")},labelTreeRequestUrl:function(){return n+"/label-trees"+this.getQueryString("labelTrees")},userRequestUrl:function(){return n+"/users"+this.getQueryString("users")}},methods:{handleSwitchedTab:function(e){this.currentTab=e},fetchEntities:function(e){0===this.entities[e].length&&(this.startLoading(),i[e].get().bind(this).then(function(t){this.entities[e]=t.data},t.handleErrorResponse).finally(this.finishLoading))},handleChosenVolumes:function(e){this.chosenEntities.volumes=e},handleChosenLabelTrees:function(e){this.chosenEntities.labelTrees=e},handleChosenUsers:function(e){this.chosenEntities.users=e},getQueryString:function(e){var t=this.entities[e],i=this.chosenEntities[e];return t.length/2>i.length?"?only="+(i.map(function(e){return e.id}).join(",")||-1):t.length>i.length?"?except="+t.filter(function(e){return-1===i.indexOf(e)}).map(function(e){return e.id}).join(","):""}},watch:{currentTab:function(e){this.fetchEntities(this.indexMap[e])}},created:function(){this.fetchEntities(this.indexMap[0])}})}),biigle.$viewModel("user-import-container",function(e){var t=biigle.$require("messages.store"),i=biigle.$require("sync.api.import"),n=biigle.$require("sync.importToken");new Vue({el:e,mixins:[biigle.$require("core.mixins.loader")],components:{entityChooser:biigle.$require("sync.components.entityChooser")},data:{importCandidates:biigle.$require("sync.importCandidates"),chosenCandidates:[],success:!1},computed:{users:function(){return this.importCandidates.map(function(e){return e.name=e.firstname+" "+e.lastname,e.email&&(e.description=e.email),e})},hasNoChosenUsers:function(){return 0===this.chosenCandidates.length},chosenCandidateIds:function(){return this.chosenCandidates.map(function(e){return e.id})}},methods:{handleChosenUsers:function(e){this.chosenCandidates=e},performImport:function(){this.startLoading();var e={};this.chosenCandidates.length<this.importCandidates.length&&(e.only=this.chosenCandidateIds),i.update({token:n},e).then(this.importSuccess,t.handleErrorResponse).finally(this.finishLoading)},importSuccess:function(){this.success=!0}},watch:{},created:function(){}})}),biigle.$declare("sync.api.import",Vue.resource("api/v1/import{/token}")),biigle.$component("sync.components.entityChooser",{template:'<div class="entity-chooser"><entity-chooser-list class="entity-chooser-list--left" :entities="unchosenFilteredEntities" :filtering="true" @select="handleSelect" @filter="handleFiltering" ></entity-chooser-list><div class="entity-chooser-buttons"><button class="btn btn-default btn-block" @click="chooseAll" :disabled="hasNoUnchosenEntities" title="Select all">all</button><button class="btn btn-default btn-block" @click="chooseNone" :disabled="hasNoChosenEntities" title="Select none">none</button></div><entity-chooser-list class="entity-chooser-list--right" :entities="chosenEntities" @select="handleDeselect"></entity-chooser-list></div>',components:{entityChooserList:biigle.$require("sync.components.entityChooserList")},props:{entities:{type:Array,required:!0}},data:function(){return{chosenIds:{},filterQuery:""}},computed:{unchosenEntities:function(){return this.entities.filter(function(e){return!this.chosenIds[e.id]},this)},unchosenFilteredEntities:function(){var e=this.filterQuery.trim();if(e){var t=e.toLowerCase().split(" ");return this.unchosenEntities.filter(function(e){var i=e.name.toLowerCase();return e.description&&(i+=" "+e.description.toLowerCase()),t.reduce(function(e,t){return e&&-1!==i.indexOf(t)},!0)})}return this.unchosenEntities},chosenEntities:function(){return this.entities.filter(function(e){return this.chosenIds[e.id]},this)},hasNoUnchosenEntities:function(){return 0===this.unchosenEntities.length},hasNoChosenEntities:function(){return 0===this.chosenEntities.length}},methods:{handleSelect:function(e){Vue.set(this.chosenIds,e.id,!0)},handleDeselect:function(e){this.chosenIds[e.id]=!1},chooseAll:function(){this.unchosenFilteredEntities.forEach(this.handleSelect)},chooseNone:function(){this.chosenEntities.forEach(this.handleDeselect)},handleFiltering:function(e){this.filterQuery=e}},watch:{chosenEntities:function(e){this.$emit("select",e)}}}),biigle.$component("sync.components.entityChooserList",{template:'<div class="entity-chooser-list"><input type="text" class="form-control entity-chooser-list-search" placeholder="Filter..." v-model="filterQuery" v-if="filtering"><ul><li v-for="e in entities" @click="select(e)"><span v-text="e.name"></span><span v-if="true"><br><span class="text-muted" v-text="e.description"></span></span></li></ul></div>',props:{entities:{type:Array,required:!0},filtering:{type:Boolean,default:!1}},data:function(){return{filterQuery:""}},methods:{select:function(e){this.$emit("select",e)}},watch:{filterQuery:function(e){this.$emit("filter",e)}}});