biigle.$viewModel("export-container",function(e){var t=biigle.$require("messages.store"),n=[biigle.$require("api.volumes"),biigle.$require("api.labelTree"),biigle.$require("api.users")],i=biigle.$require("sync.exportApiUrl");new Vue({el:e,mixins:[biigle.$require("core.mixins.loader")],components:{tabs:VueStrap.tabs,tab:VueStrap.tab,entityChooser:biigle.$require("sync.components.entityChooser")},data:{entities:[[],[],[]],chosenEntities:[[],[],[]],currentTab:0},computed:{volumes:function(){return this.entities[0]},labelTrees:function(){return this.entities[1]},users:function(){return this.entities[2].map(function(e){return e.name=e.firstname+" "+e.lastname,e.email&&(e.description=e.email),e})},hasChosenVolumes:function(){return this.chosenEntities[0].length>0},hasChosenLabelTrees:function(){return this.chosenEntities[1].length>0},hasChosenUsers:function(){return this.chosenEntities[2].length>0},volumeRequestUrl:function(){return i+"/volumes"},labelTreeRequestUrl:function(){return i+"/label-trees"},userRequestUrl:function(){return i+"/users"}},methods:{handleSwitchedTab:function(e){this.currentTab=e},fetchEntities:function(e){0===this.entities[e].length&&(this.startLoading(),n[e].get().bind(this).then(function(t){Vue.set(this.entities,e,t.data)},t.handleErrorResponse).finally(this.finishLoading))},setEntities:function(e){this.entities=e.body},handleChosenVolumes:function(e){Vue.set(this.chosenEntities,0,e)},handleChosenLabelTrees:function(e){Vue.set(this.chosenEntities,1,e)},handleChosenUsers:function(e){Vue.set(this.chosenEntities,2,e)}},watch:{currentTab:function(e){this.fetchEntities(e)}},created:function(){this.fetchEntities(this.currentTab)}})}),biigle.$component("sync.components.entityChooser",{template:"#entity-chooser-template",components:{entityChooserList:biigle.$require("sync.components.entityChooserList")},props:{entities:{type:Array,required:!0}},data:function(){return{chosenIds:{},filterQuery:""}},computed:{unchosenEntities:function(){return this.entities.filter(function(e){return!this.chosenIds[e.id]},this)},unchosenFilteredEntities:function(){var e=this.filterQuery.trim();if(e){var t=e.toLowerCase().split(" ");return this.unchosenEntities.filter(function(e){var n=e.name.toLowerCase();return t.reduce(function(e,t){return e&&-1!==n.indexOf(t)},!0)})}return this.unchosenEntities},chosenEntities:function(){return this.entities.filter(function(e){return this.chosenIds[e.id]},this)},hasNoUnchosenEntities:function(){return 0===this.unchosenEntities.length},hasNoChosenEntities:function(){return 0===this.chosenEntities.length}},methods:{handleSelect:function(e){Vue.set(this.chosenIds,e.id,!0)},handleDeselect:function(e){this.chosenIds[e.id]=!1},chooseAll:function(){this.unchosenFilteredEntities.forEach(this.handleSelect)},chooseNone:function(){this.chosenEntities.forEach(this.handleDeselect)},handleFiltering:function(e){this.filterQuery=e}},watch:{chosenEntities:function(e){this.$emit("select",e)}}}),biigle.$component("sync.components.entityChooserList",{template:"#entity-chooser-list-template",props:{entities:{type:Array,required:!0},filtering:{type:Boolean,default:!1}},data:function(){return{filterQuery:""}},computed:{},methods:{select:function(e){this.$emit("select",e)}},watch:{filterQuery:function(e){this.$emit("filter",e)}}});